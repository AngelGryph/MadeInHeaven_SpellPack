<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>All SFO-LUA functions</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../../doc/files/g3readme_cam_022916_dwedit.css" type="text/css" />
<link href="../../doc/files/g3icon.ico" rel="icon" type="image/bmp" />
</head>
<body>
<div id="container">
<div class="ribbon_bubble">
    <div class="ribbon_rectangle">
<h1>All SFO-LUA functions</h1>
</div>
    <div class="ribbon_triangle-l"></div>
    <div class="ribbon_triangle-r"></div>

<div class="section">

</div>

<div class="ribbon_rectangle_h2"><h2>Description</h2> </div>
    <div class="ribbon_triangle_h2-l"></div>
    <div class="ribbon_triangle_h2-r"></div>

<div class="section">
This lists all functions that appear in the SFO-LUA library, alphabetically.</p><p><ul><li><a href="all_functions.html">All SFO and SFO-LUA functions</a></li><li><a href="all_sfo_functions.html">All SFO functions</a></li><li><a href="all_sfo_lua_functions.html">All SFO-LUA functions</a></li><li><a href="function_index.html">Function Index (includes internal/deprecated functions)</a></li><li><a href="index.html">Main menu</a></li></ul>
</div>

<div class="ribbon_rectangle_h2"><h2>Public Functions</h2> </div>
    <div class="ribbon_triangle_h2-l"></div>
    <div class="ribbon_triangle_h2-r"></div>

<div class="section">
<p><strong>add_dual_class_kit_option(kit:s, oldclass:s, oldkit:s, newclass:s)=()</strong> action (<a href="ui_dual_class_kits.html">ui_dual_class_kits</a>)<br></p><p>
Enable dual-classing from kit 'oldkit' of old class 'oldclass', into kit 'kit' of class 'newclass'. Class entries should be IDS entries like 'FIGHTER'. Kit entries should 
be kitlist.2da rownames.
</p>
<p><strong>add_elem_spell_desc(elem_string:s, spell:s)=()</strong> action (<a href="ui_spell_system_elemental.html">ui_spell_system_elemental</a>)<br></p>
<p><strong>add_ini_func()=()</strong> patch (<a href="ui_set_ini_globals.html">ui_set_ini_globals</a>)<br></p>
<p><strong>add_kit_menu(name:i, desc:i, title:i, trueclass_desc:i, name_strref:i, desc_strref:i, title_strref:i, trueclass_desc_strref:i, id:s, kits:s, class:s)=()</strong> action (<a href="ui_virtual_class.html">ui_virtual_class</a>)<br></p><p>
This creates a kit-selection menu for a given class. All kits in the space-separated list 'kits' (identified by kitlist.2da rownames) for the class 'class' (identified by a class.ids entry) are grouped into their own menu. 'id' is some unique identifier for this menu (use a modder prefix).</p>
<p> 'name', 'desc' and 'title' should be the numbers of entries in the currently-loaded tra file. 'name' is the name of the menu itself (displayed in place of a kit name on the parent class's kit menu). 'title' is the name for the submenu (replacing 'Choose Kit'). 'desc' is the description
displayed when you click or mouse over the submenu on the main kit-selection screen.</p></p><p><p>For instance, if you want to gather several dragon disciple kits together, 'name' might be 'Dragon Disciple', 'desc' might be the general description for Dragon Disciples, and 'title' might be 'Choose Dragon' or similar.
</p>
<p><strong>add_pseudorace(NAME:s="-1", DESC:s="-1", REAL_RACE:s="-1")=()</strong> action (<a href="ui_add_subraces.html">ui_add_subraces</a>)<br></p><p>
Add a single race to SFO's master table of pseudoraces. (This only updates the <b>tables</b>; the game itself is not updated.)
</p>
<p><strong>add_race(race:s, NAME:s, DESCSTR:s, UPPERCASE:s, BIOGRAPHY:s)=()</strong> action (<a href="ui_add_subraces.html">ui_add_subraces</a>)<br></p><p>
Add a single race to SFO's master table of races. (This only updates the <b>tables</b>; the game itself is not updated.)
</p>
<p><strong>add_subrace(COLOR_SKIN:i="-1", COLOR_HAIR:i="-1", COLOR_MAJOR:i="-1", COLOR_MINOR:i="-1", STR:i, DEX:i, CON:i, INT:i, WIS:i, CHA:i, EXTRA_PROF:i, PP:i, OL:i, FT:i, MS:i, HS:i, DI:i, ST:i, subrace:s, NAME:s, DESC:s, PARENT:s, FINAL_RACE:s="*", ICON:s="-1", ICON_STRREF:s="-1", BIO_OLD:s="-1", BIO_NEW:s="-1", SPL_INIT:s, SPL_RECUR:s)=()</strong> action (<a href="ui_add_subraces.html">ui_add_subraces</a>)<br></p><p>
Add a single subrace to SFO's master table of subraces. (This only updates the <b>tables</b>; the game itself is not updated.)
</p>
<p><strong>add_to_clab_level_1(clab:s, spell:s)=()</strong> dimorphic (<a href="ui_extra_spells.html">ui_extra_spells</a>)<br></p><p>
Lightweight adder that just adds the spell to a CLAB file
</p>
<p><strong>add_to_subrace_tables(subrace_table:s, race_table:s, pseudorace_table:s, disabled:s, table_path:s)=()</strong> action (<a href="ui_add_subraces.html">ui_add_subraces</a>)<br></p><p>
Take a bunch of tables defining race, subrace and pseudorace and add them to SFO's master tables. 
(This only updates the <b>tables</b>; the game itself is not updated.)
</p>
<p><strong>add_virtual_class(multiclass:b, name:i, desc:i, name_strref:i, desc_strref:i, ident:s, parent:s, human:s, dwarf:s, elf:s, gnome:s, halfling:s, half_elf:s, halforc:s, all_races:s="true")=()</strong> action (<a href="ui_virtual_class.html">ui_virtual_class</a>)<br></p><p></p><p>This adds a new virtual class to the class-selection menu (to the single-class bit unless multiclass is set to 1). You need to specify a unique string 'ident' to identify the class, and a real class ('parent', an entry in class.ids) as its parent.</p></p><p><p>You also need a name and description, specifiable either as a tra ref ('name', 'desc') or directly as a strref ('name_strref', 'desc_strref').</p></p><p><p>By default, the class will be available to all races. To restrict it, set 'all_races' to 'false' and then set each of 'human', 'dwarf' etc to 'true' if you want it available.
</p>
<p><strong>assign_bonus_spells(update_description:b=1, skip_clab:b, class:s, kit:s, spells:s, spell_array:s, tra:s="sfo_lua", tra_path:s="DEFAULT")=()</strong> action (<a href="ui_bonus_spells.html">ui_bonus_spells</a>)<br></p><p>
Given kit 'kit, and a space-separated list of spells 'spells' and/or a k=>_ array of spells 'spell_array', grant those spells as bonus
learned spells at the appropriate level, making appropriate LUA and CLAB changes to do so.</p></p><p><p>Spells can be given as bare resrefs, or as spell.ids entries, or as dw_ext_spell.ids entries, or as abbreviated entries (i.e., with the 'WIZARD_' or 'CLERIC_' 
preamble stripped (if ambiguous, we assume WIZARD). Spells of the wrong type (i.e. cleric spells for wizards, or vice versa) are autoconverted to the appropriate type using the lib_splconv
library.</p></p><p><p>Multiclass kits can be handled, but only if they're in SFO format and only on a full sfo install (we use lib_kit functionality). The parent class can normally be inferred; if
you are adding bonus spells to a cleric/mage, you need to specify 'class' explicitly as cleric or mage.</p></p><p><p>The function will attempt to update the kit description (you can tell it not to by setting update_description=0). It needs to be given a tra file and a tra path; the defaults
point to lua/lang and to sfo-lua's default tra file. (Look at that file for format if you want to do your own.) The same tra file is also passed to the splconv function to make
any cleric->wizard and wizard->cleric conversion descriptions.</p><p>If you set skip_clab to 1, the new spells are added to the LUA and the kit description, but not to the CLAB. (This is useful if you're cloning an existing kit.)
</p>
<p><strong>assign_kit_to_virtual_class(kit:s, class:s)=()</strong> action (<a href="ui_virtual_class.html">ui_virtual_class</a>)<br></p><p>
The kit 'kit' (a rowname from kitlist.2da) is added to the virtual class 'class' (the unique ID for the class, specified in add_virtual_class). The kit needs to be a legal kit for the parent class of the virtual class, and will now be displayed in the virtual class's kit menu rather than the real class's menu.
</p>
<p><strong>assign_spheres(update_scroll_usability:i=1, update_scrolls_later:i=1, update_description:i=1, class:s, kit:s, kit_clastext:s, spheres:s, default:s, add:s, subtract:s, block:s, base_tra:s=sfo_lua, base_tra_path:s="DEFAULT")=()</strong> action (<a href="ui_spell_system_spheres.html">ui_spell_system_spheres</a>)<br></p><p>
Allocate spheres to a given kit or class.
</p>
<p><strong>bonus_spells_from_list(skip_clab:b, update_description:i=1, kit:s, path:s, class:s)=()</strong> action (<a href="ui_bonus_spells.html">ui_bonus_spells</a>)<br></p><p>
Loads the file in 'path' (which should be a 2-column table - the first column is conventionally a level, but need not be).
Go through the entries in the second column. Each is a |-separated list of spell ids entries (possibly including extended-namespace
ids). Assign the first entry in each column that actually exists as an installed spell as a bonus spell to the kit 'kit'. </p><p></p>
<p><strong>build_subraces(tlk_signal_start:i=900000, delay_mode:b)=()</strong> action (<a href="ui_add_subraces.html">ui_add_subraces</a>)<br></p><p>
Operate on the subrace tables to actually construct the subraces
if delay_mode=1, introduce a 1-second delay into the spells (for experimental HoW compatibility, though we haven't got this stable yet).
</p>
<p><strong>color_finder_tool()=()</strong> action (<a href="ui_add_portraits.html">ui_add_portraits</a>)<br></p><p>
NOT FOR LIVE USE - alter the UI so that the CHARGEN color customization screen displays the numerical values of the chosen colors
</p>
<p><strong>define_spell_list(determine_empty_levels:b, empty_level_max:i=9, silent:b, spells:s, key:s, list_name:s, spell_array:s)=()</strong> action (<a href="ui_spell_system.html">ui_spell_system</a>)<br></p><p>
Given a space-separated list of spells 'spells', and/or an array spell=>_ or spell=>spell_level of spells, and a string 'key',
construct a spell list 'key' comprising those spells. If you use the spell=>spell_level format, it saves looking up the levels of the spells).</p></p><p><p>Spells can be given either as resrefs or as IDS entries (if the latter, they need to have been loaded into memory using data_spell_resrefs).
If a spell is missing, whine unless silent=1.</p></p><p><p>If determine_empty_levels=1, also record which levels are empty in the lua output. (empty_level_max is the highest level at which this is done - default is 9.)</p></p><p><p>Spell system is automatically set up if it isn't already.
</p>
<p><strong>detect_chargen_status()=()</strong> action (<a href="ui_shared_code.html">ui_shared_code</a>)<br></p><p>
Install the detect_chargen_status LUA functions in m_dw_shr.lua (these functions are used by other SFO functions (and elsewhere in ToF) to detect whether a given menu is being called as part of chargen)</p><p></p>
<p><strong>disable_subrace(subrace:s)=()</strong> action (<a href="ui_add_subraces.html">ui_add_subraces</a>)<br></p><p>
Disable the listed subrace (assumed to be installed) from the list of subraces offered to the player
in character generation.</p><p></p>
<p><strong>dual_class_kits()=()</strong> action (<a href="ui_dual_class_kits.html">ui_dual_class_kits</a>)<br></p><p>
Do setup work, ready to install specific dual-class kits.</p><p></p>
<p><strong>exclude_subrace(kit:s, subrace:s)=()</strong> action (<a href="ui_virtual_class.html">ui_virtual_class</a>)<br></p><p>
This forces 'kit' (a rowname entry from kitlist.2da) to prohibit characters of subrace 'subrace' (an ID from the sfo-lua-generated table 'dw_subrace_ids.2da' in dw_shared).
</p>
<p><strong>extended_add_spell(force_extended:i, replace:i, id:s, file:s, path:s, location:s, locbase:s, exclude_alignment:s, exclude_kit:s, include_class:s)=(resref:s)</strong> action (<a href="ui_extra_spells.html">ui_extra_spells</a>)<br></p><p></p><p></p>
<p><strong>extended_add_spell_helper(force_extended:i, level:i, type_num:i, type:s, id:s)=(resref:s, lua_line_needed:s)</strong> action (<a href="ui_extra_spells.html">ui_extra_spells</a>)<br></p>
<p><strong>extended_spell_test()=()</strong> action (<a href="ui_extra_spells.html">ui_extra_spells</a>)<br></p><p>
This just copies 10 spells of each level into the 51-55 and extended namespaces, for testing. 
It also makes the Doom copy (SPPR1A3) good-only
</p>
<p><strong>externalize_profsmax()=()</strong> action (<a href="ui_externalize_proficiencies.html">ui_externalize_proficiencies</a>)<br></p><p>
This moves the functionality of profsmax.2da to the LUA, permitting control of maximum proficiencies at a finer grain than the engine permits (in particular, this is
required for libraries like ui_add_subraces that use proficiencies to signal).
</p>
<p><strong>externalize_weapprof()=()</strong> action (<a href="ui_externalize_proficiencies.html">ui_externalize_proficiencies</a>)<br></p><p>
This moves the functionality of weapprof.2da to the LUA, permitting control of allowed proficiencies at a finer grain than the core engine permits.
</p>
<p><strong>get_spell_array(list:s, root:s)=(this_array:a)</strong> action (<a href="ui_spell_system.html">ui_spell_system</a>)<br></p><p>
Given 'root' either SPPR or SPWI, and 'list' a list of spell-list keys,
return an array of all spells with that root, in the format resref=>[01],
with the value being 1 iff the spell is in one of the lists.</p><p>If list is 'cleric' or 'druid', instead parse the spell directly and check its
usability fla</p><p></p>
<p><strong>get_virtual_parent_classes()=(virtual_parent_classes:a)</strong> action (<a href="ui_virtual_class.html">ui_virtual_class</a>)<br></p><p>
Parses m_dw_vcd.lua to extract an array of virtual classes, in the form $virtual_parent_class([virtual class id])=[id of first kit included in the class]
</p>
<p><strong>get_weapprof_path()=(weapprof_path:s)</strong> action (<a href="ui_externalize_proficiencies.html">ui_externalize_proficiencies</a>)<br></p><p>
This returns either 'override/weapprof.2da' or '[data_loc_shared]/weapprof.2da', depending on whether the weapprof system has been externalized.
</p>
<p><strong>hide_ability_button_for_kit(kit:s, buttons:s)=()</strong> action (<a href="ui_hide_ability_button.html">ui_hide_ability_button</a>)<br></p><p>
The kit 'kit' has the button(s) 'buttons' hidden by the UI. 'kit' is a rowname entry from kitlist.2da. 'Buttons' is a space-separated list of strings
which appear as 'button' in enginest.2da entries of form STRREF_GUI_BUTTONS_[button].</p><p>
</p>
<p><strong>hide_hla(resref:s)=()</strong> action (<a href="ui_externalize_hlas.html">ui_externalize_hlas</a>)<br></p><p>
Given the resref of a HLA, that HLA is hidden (i.e., player-unselectable) for all players on the HLA screen. (Mostly used internally; in general it will be more sensible
just to remove the HLA from the LU files.)
</p>
<p><strong>hide_proficiency(id:i)=()</strong> action (<a href="ui_externalize_proficiencies.html">ui_externalize_proficiencies</a>)<br></p><p>
This hides the proficiency with id 'id' so that it is not displayed on the proficiency select screen.
</p>
<p><strong>hide_this_displayed_ability(string:s)=()</strong> action (<a href="ui_shared_code.html">ui_shared_code</a>)<br></p><p>
Mark a specific ability (or space-separated list of abilities) to be hidden on the character sheet. Abilities are identified by their enginst.2da ID.</p>
<p><strong>ini_global_add(default:i, add_to_ini:i, type:s, id:s, global:s)=()</strong> dimorphic (<a href="ui_set_ini_globals.html">ui_set_ini_globals</a>)<br></p>
<p><strong>ini_global_add_function(function:s)=()</strong> dimorphic (<a href="ui_set_ini_globals.html">ui_set_ini_globals</a>)<br></p>
<p><strong>ini_global_setup()=()</strong> action (<a href="ui_set_ini_globals.html">ui_set_ini_globals</a>)<br></p>
<p><strong>install_extended_spell_functions()=()</strong> action (<a href="ui_extra_spells.html">ui_extra_spells</a>)<br></p><p>
Add the LUA functions and menu edits to enable extended spells. 
Most of this is now externalized to the onOpen and systemcall libraries.
</p>
<p><strong>make_elemental_spell_lists(adjust_description:i=1, tra:s=sfo_lua, tra_path:s="DEFAULT")=(earth_names:s, air_names:s, fire_names:s, water_names:s, all_names:s)</strong> action (<a href="ui_spell_system_elemental.html">ui_spell_system_elemental</a>)<br></p><p>
Create LUA spell lists for each element.
</p>
<p><strong>make_extended_spell_line(add_to_clab:i, resref:s, include_class:s, exclude_kit:s, exclude_alignment:s)=(line:s, no_align_restrictions:s, lua_array:s, class_bar:a, kit_bar:a, align_bar:a)</strong> patch (<a href="ui_extra_spells.html">ui_extra_spells</a>)<br></p>
<p><strong>make_force_spell_lists()=()</strong> action (<a href="ui_spell_system_elemental.html">ui_spell_system_elemental</a>)<br></p><p>
Create LUA lists of all force spells.
</p>
<p><strong>no_int_max_spells()=()</strong> action (<a href="ui_spell_system.html">ui_spell_system</a>)<br></p>
<p><strong>override_chargen_kit_name(override:i, use_tra:b=1, kit:s, class:s, lua:s="m_dw_vcd")=()</strong> action (<a href="ui_virtual_class.html">ui_virtual_class</a>)<br></p><p>
This function overrides the name displayed on the character-generation selection screen (but not on the character sheet) for a specific kit, which is specified both by 'kit' (a rowname entry from kitlist.2da) and 'class' (an entry in class.ids).</p></p><p><p>The integer 'override' specifies the new name. By default it's an entry drawn from the current tra file. If use_tra is set to 0, it's instead a strref.</p>
<p>'lua' lists where the override instruction is stored. (Don't change this off the default unless you know what you're doing and have a very good reason.)</p>
</p>
<p><strong>override_class_kit_menu(virtual:b, title_tra:i="-1", class:s, title:s)=()</strong> action (<a href="ui_virtual_class.html">ui_virtual_class</a>)<br></p><p>
This changes the title of a kit-selection menu in character generation. 'Class' should be an entry from class.ids, or the ID of a virtual class (in the latter case, you need to set virtual=1). You can set the title either directly as a string ('title') or indirectly as the tra number of a line in the current tra file ('title_tra').
</p>
<p><strong>override_class_kit_menu_setup()=()</strong> action (<a href="ui_virtual_class.html">ui_virtual_class</a>)<br></p>
<p><strong>override_hla_description(strref:i, resref:s)=()</strong> action (<a href="ui_externalize_hlas.html">ui_externalize_hlas</a>)<br></p><p>
This replaces the description shown on the HLA select screen for HLA 'resref' with the strref 'strref'. It requires ui_externalize_hlas to have been run.
</p>
<p><strong>override_hla_name(strref:i, resref:s)=()</strong> action (<a href="ui_externalize_hlas.html">ui_externalize_hlas</a>)<br></p><p>
This replaces the name shown on the HLA select screen for HLA 'resref' with the strref 'strref'. It requires ui_externalize_hlas to have been run.
</p>
<p><strong>override_kit_desc_data(old_1_strref:i, new_1_strref:i, old_2_strref:i, new_2_strref:i, old_3_strref:i, new_3_strref:i, kit:s, swap:s, old_1:s, new_1:s, old_2:s, new_2:s, old_3:s, new_3:s)=()</strong> action (<a href="ui_virtual_class.html">ui_virtual_class</a>)<br></p><p>
This function overrides the displayed class names on a character's character sheet. Its main use is for multiclass kits, so that the names of the kit components show up instead of the class components.
The 'kit' variable (which should be a kitlist 2da rowname) specifies the kit for which the override should be applied.</p></p><p><p>You can specify the override in several ways. The simplest (which is usually sufficient) is to set 'swap' to a list of class=>kit swaps, e.g. swap="fighter=>kensai thief=>assasin". Here 'class' should be a class.ids entry, and 'kit' should be a 
kitlist.2da rowname. You can also directly specify strings to be swapped out and in, either by strref (old_[123]_strref is swapped for new_[123]_strref) or directly by string (old_[123] is swapped for new_[123]).
</p>
<p><strong>parse_spell_lists(allow_learn:s, block_learn:s, allow_priest:s, block_priest:s, type:s="priest")=(spell_array:a)</strong> action (<a href="ui_spell_system.html">ui_spell_system</a>)<br></p><p>
Given the 'allow_learn', 'block_learn', 'allow_priest', 'block_priest' values for some (actual or fictional)
kit, and its type (either 'priest' or 'mage') return an array of all usable spells, in the format resref=>1</p><p></p>
<p><strong>process_extended_spells()=()</strong> action (<a href="ui_extra_spells.html">ui_extra_spells</a>)<br></p><p>
Get the extended-namespace spells into lua and into auto-grant spells.
</p>
<p><strong>process_favored_enemy_ini(file:s, location:s, locbase:s, path:s)=()</strong> action (<a href="ui_ranger_favored_enemy.html">ui_ranger_favored_enemy</a>)<br></p><p>
Process an ini file identifying various ranger favored enemies, in SFO's format. The format is a series of blocks like:
<br>[SKELETAL_UNDEAD]
<br>race=LICH,DEMILICH
<br>primary_race=SKELETON
<br>name=3
<br>desc=4
</p>
<p>Here: SKELETAL_UNDEAD is an internal identifier. 'primary_race' is the race that actually gets set as a favored enemy in the game engine. 'race' is a comma-separated
list of other races that SFO fakes up as additional favored enemies. 'name' and 'desc' are TRA references to the name and description of the favored enemy as shown on the selection screen.</p><p></p>
<p><strong>process_scroll_usability_now()=()</strong> action (<a href="ui_spell_system.html">ui_spell_system</a>)<br></p>
<p><strong>rechoose_ranger_favored_enemy(levels:s)=()</strong> action (<a href="ui_ranger_favored_enemy.html">ui_ranger_favored_enemy</a>)<br></p><p>
Given a space-separated list of numbers, allow rangers to rechoose their favored enemy at every level in the list.
</p>
<p><strong>remove_erase_bg()=()</strong> patch (<a href="ui_spell_system.html">ui_spell_system</a>)<br></p>
<p><strong>remove_erase_iwd()=()</strong> patch (<a href="ui_spell_system.html">ui_spell_system</a>)<br></p>
<p><strong>require_gender(kit:s, gender:[male|female])=()</strong> action (<a href="ui_virtual_class.html">ui_virtual_class</a>)<br></p><p>
This forces 'kit' (a rowname entry from kitlist.2da) to require the character to be male or to be female, according to what 'gender' is set to.
</p>
<p><strong>scroll_spec_bonus_setup()=()</strong> action (<a href="ui_spell_system.html">ui_spell_system</a>)<br></p><p>
Build the various resources needed for the externalized bonus-spell setup.
</p>
<p><strong>set_basic_hla_progression(min:i, step:i)=()</strong> action (<a href="ui_externalize_hlas.html">ui_externalize_hlas</a>)<br></p><p>
This function sets the HLA progression (prior to crossing the threshold for 'genuine' HLAs, i.e. 3M XP in BG2, so that you start getting them at level
min and then get another one every step levels.</p><p></p>
<p><strong>set_dual_class_kit_components_for_proficiencies(kit:s, components:s)=()</strong> action (<a href="ui_externalize_proficiencies.html">ui_externalize_proficiencies</a>)<br></p><p>
I don't 100% recall what this does. It's described in my notes like this:
'set the single-class kits that override multiclass kit proficiencies for dc purposes'.</p><p></p>
<p><strong>set_kit_display_priority(priority:i, kit:s)=()</strong> action (<a href="ui_virtual_class.html">ui_virtual_class</a>)<br></p><p>
This assigns an integer 'priority' to the kit 'kit' (specified by a kitlist.2da rowname). This determines the order in which the kits are displayed at character selection: kits are displayed in increasing order of order priority, with kits that have no order priority 
displayed last and kits displayed in alphabetical order within each priority.
</p>
<p><strong>set_signalling_stat(stat:i)=()</strong> action (<a href="ui_externalize_proficiencies.html">ui_externalize_proficiencies</a>)<br></p><p>
This sets up the stat 'stat' to be used by other UI libraries to send a signal from the chargen screen to the main game. Don't use unless you're confident you know what you're doing.
</p>
<p><strong>set_signalling_stat_helper(stat:i)=()</strong> patch (<a href="ui_externalize_proficiencies.html">ui_externalize_proficiencies</a>)<br></p>
<p><strong>set_specialist_spells(number_required:i=1, list_spells:b=1, update_description:b, learn_more_line:s, memorize_more_line:s, old_line:s, new_line_1:s, new_line_2:s, string_school:s, string_school2:s, kit:s, spell_list:s, tra:s="sfo_lua", tra_path:s)=()</strong> action (<a href="ui_spell_system.html">ui_spell_system</a>)<br></p><p>
Given a kit 'kit' (a rowname entry in kitlist.2da), an optional integer 'number_required' (default=1) and a space-separated list of spell-list keys 'spell_list',
require that kit to learn at least number_required spells from that list.</p></p><p><p>The optional 'learn_more_line' and 'memorize_more_line' are displayed to players in character generation if they don't learn/memorize an appropriate number of speciality spells. (If not set, the component autogenerates a default warning.)</p>
<p>The variables 'tra' and 'tra_path' specify where some standard strings are drawn from (the default assumption is that they're from sfo/lua/lang//sfo_lua.tra").</p></p><p>
<p>If update_description is set to 1, the function will attempt to update the kit description. (This only works with kits in a relatively standard format.)
The various other variables control how this works:
<ul>
<li>'old_line' is by default 'May cast one additional spell per level.', but it can be any 'advantage' or 'disadvantage' line from the kit description. It is deleted from the kit description if present.
<li>'school_string' is by default 'from the LISTNAME school', where LISTNAME is the name-string of the specialist list, or the last such list if there is more than one.
<li>'new_line_1' is by default 'May cast one additional spell per level. This additional spell must be SCHOOL_PLACEHOLDER'; SCHOOL_PLACEHOLDER is swapped for 'string_school'. It is added to the top of the 'Advantages' list
if number_required=1.
<li>'new_line_2' is by default 'May cast one additional spell per level. At least NUMBER_PLACEHOLDER memorized spells of each level must be SCHOOL_PLACEHOLDER'; SCHOOL_PLACEHOLDER is swapped for 'string_school' and NUMBER_PLACEHOLDER is swapped for the value of 'number_required'. It is added to the top of the 'Advantages' list if number_required>1.
<li>
<li>list_spells, if set, includes a list of all spells from the preferred list. In this case, 'string_school2' (default value: the name-string of the specialist list, or the last such list if there is more than one) is substituted into the string 'The full list of SCHOOL_PLACEHOLDER_2 spells is:'.</li>
</ul>
</p>
<p><strong>set_spell_learn_modifiers(kit:s, modifiers:s)=()</strong> action (<a href="ui_spell_system.html">ui_spell_system</a>)<br></p><p>
Set the externalized modifications to the chance of learning a spell. Specify 'kit' (a rowname from kitlist) and 'modifiers' (the actual LUA list of modifiers).
'modifiers' should be a comma-separated list with elements of form 'list=integer', where 'list' is either a spell list or 'default' (applies to all spell lists not called out.)
</p>
<p><strong>set_spell_list(chargen_choose_spells:b, update_scroll_usability:b=1, update_scrolls_later:b, silent:b, import_parent_blocks:b=1, class:s, kit:s, kit_clastext:s, block_learn:s="no_change", allow_learn:s="no_change", block_priest:s="no_change", allow_priest:s="no_change")=()</strong> action (<a href="ui_spell_system.html">ui_spell_system</a>)<br></p><p>
Set the spell lists available to, or blocked for, a given class or kit (either set class to a class.ids entry, or kit to a 
kitlist.2da rowname). Each of block_learn, allow_learn, block_priest, or allow_priest can be a space-separated or comma-separated
list of spell-list keys, or 'no_change' (the default) in which case whatever it's currently set to will be unchanged.</p></p><p><p>If chargen_choose_spells=1, the lua also sets dwChargenChooseSpells to 1 for that class or kit. That causes the UI to try to
learn spells from the character's specialist list, if any. [This is an odd place to put this, on reflection.]</p></p><p><p>If update_scroll_usability=1, we also go through all scrolls and mark them up as usable/unusable for that class/kit.</p></p><p><p>If the spell system is not already set up, we set it up.
</p>
<p><strong>set_up_externalized_proficiencies()=()</strong> action (<a href="ui_externalize_proficiencies.html">ui_externalize_proficiencies</a>)<br></p><p>
This function is a general setup for the ui_externalize_proficiency functions.
</p>
<p><strong>shared_color_changes()=()</strong> action (<a href="ui_shared_code.html">ui_shared_code</a>)<br></p><p>
Installs the LUA function 'dwUpdateColors' into m_dw_shr.lua (this function is used to force the starting
colors during CHARGEN, e.g. for subrace or portrait-match purposes)
</p>
<p><strong>spell_system_extension_setup()=()</strong> action (<a href="ui_extra_spells.html">ui_extra_spells</a>)<br></p>
<p><strong>spl_basic_ability_localcopy()=()</strong> patch (<a href="ui_extra_spells.html">ui_extra_spells</a>)<br></p>
<p><strong>systemcall_patch()=()</strong> patch (<a href="ui_system_call.html">ui_system_call</a>)<br></p>
<p><strong>ui_add_portraits(force_cd:i, portrait_path:s, portrait_table:s, disable:s, enable:s)=()</strong> action (<a href="ui_add_portraits.html">ui_add_portraits</a>)<br></p><p>Add some new portraits into the system, or modify existing ones (EE only)</p></p><p><p>The portraits should be listed in a 2DA table of form
<table>
<tr><td></td>  			<td>skin</td>	<td>hair</td>	<td>major</td>	<td>minor</td>	<td>race</td>	<td>sex</td>		<td>class</td>		<td>disabled</td></tr>
<td>EXAMPLE</td>	   <td>INT</td>		<td>INT</td>	<td>INT</td>	<td>INT</td>	<td>human</td>	<td>f</td>			<td>fighter</td>	<td>no</td></tr>
</table>
 (any of these columns can be missing, in which case defaults are assumed.) The function generates
a master table of this form which lives in the 'shared' subdirectory of weidu_external (specifically,
at weidu_external/data/shared/dw_portraits.2da)</p>
<p>
<ul>
<li>'skin', 'hair', 'major' and 'minor' are the colors - as used by the UI - that should be assigned by default if the portrait is selected. (You can edit these 
<li>'race' can be any of human, halfelf, elf, dwarf, halfling, gnome, halforc, special (the default).</li>
<li>'class' can be fighter, wizard, cleric, thief, bard, barbarian, special (the default).</li>
<li>'sex' can be f, m, fm (the default).</li>
<li>'disabled' can be yes or no (the default).</li>
</ul>
</p>
<p>The bmps themselves should be named as follows:
<ul>
<li>EXAMPLEhires.bmp (for large high-resolution portraits) - copied to the L slot</li>
<li>EXAMPLE330.bmp - also copied to the L slot</li>
<li>EXAMPLEL.bmp - copied direct to the L slot</li>
<li>EXAMPLE269.bmp - copied to the M slot</li>
<li>EXAMPLEM.bmp - copied to the M slot</li>
</ul>
<p>
<p>The function takes these variables:
<ul>
<li>portrait_table: the full path to a new table, of the above form, to be added
<li>portrait_path: the path to the directory containing any new portrait BMPs listed in the table (or, if no table is given, containing any 
<li>portrait BMPs just to be copied over directly - mostly applies to the core IWD/BG/BG2 portraits)
<li>disable: a list, separated by spaces, of portrait base names to disable from the system
<li>enable: a list, separated by spaces, of portrait base names to enable in the systems
</ul>
<p>On a non-EE install we default to CamDawg's cd_portrait_copy (which is assumed as a dependency); you can force this even on EE by setting INT_VAR force_cd=1.
</p>
<p><strong>ui_copy_spell_lists(from:s, to:s)=()</strong> action (<a href="ui_spell_system.html">ui_spell_system</a>)<br></p><p>
Read in the spell lists associated with a given kit, and copy it to a different kit
</p>
<p><strong>ui_deolvynize()=(value:s)</strong> action (<a href="ui_deolvynize.html">ui_deolvynize</a>)<br></p><p>
This attempts to reverse the effect of OlvynChuru's ClassSpellTool function on menu.ui and to move all spells added by ClassSpellTools to the SFO-lua system. It's not been extensively tested in the wild.</p>
<p>Idempotent (you can run it as many times as you like).</p><p></p>
<p><strong>ui_detect_class_kit(version:s)=()</strong> action (<a href="ui_detect_class_kit.html">ui_detect_class_kit</a>)<br></p><p>
Set up all the resources to detect the class and kit (etc). Note that unlike other SFO-lua libraries, this one just reinstalls itself every time you build it (since new classes and kits may have been added).
'Version', if set to 1, is used for debugging.
</p>
<p><strong>ui_dualclass_specialist_bonus_spells()=()</strong> action (<a href="ui_dual_class_kits.html">ui_dual_class_kits</a>)<br></p>
<p><strong>ui_externalize_hlas(min:i, step:i, activate_feats:i=1)=()</strong> action (<a href="ui_externalize_hlas.html">ui_externalize_hlas</a>)<br></p><p>
This (idempotent) function sets up the HLA system to grant HLAs every few levels (starting with level min, and then after every step levels) and to externalize requirements for various HLAs. In doing so it sets up an HLA
menu if (as in IWD or BG) none is active; it also removes the icon column from the BG2 HLA menu, since that requires multiple icons for applied powers that aren't really
needed and which push the art requirements.</p>
<p>
If activate_feats=0, the low-level feats are not enabled (only the other externalizations are enabled).
</p></p><p></p>
<p><strong>ui_externalize_usability_descriptions(strref:i="-1", kit:s, item:s, item_array:s="sfo_reserved_usability_array")=()</strong> dimorphic (<a href="ui_externalize_usability_descriptions.html">ui_externalize_usability_descriptions</a>)<br></p><p></p>
<p><strong>ui_externalize_usability_descriptions_setup()=()</strong> action (<a href="ui_externalize_usability_descriptions.html">ui_externalize_usability_descriptions</a>)<br></p>
<p><strong>ui_inn_label()=()</strong> action (<a href="ui_inn_label.html">ui_inn_label</a>)<br></p><p>
After running this function, once you stay in an inn the room type (from 1 to 4, with - iirc - 1 as worst) is stored in the global 
variable dw_inn_roomtype. It gets reset once you rest again, so pick it up and change it to zero quickly if you want to interact with it.</p>
<p><strong>ui_on_open_setup()=()</strong> action (<a href="ui_on_open.html">ui_on_open</a>)<br></p><p>
Sets up the ui_on_open library's systematic hijacking of ui.menu's onOpen command. This function is called automatically by other sfo-lua libraries: it is highly unlikely that any mod will need to call it directly.
</p>
<p><strong>ui_read_all_spell_lists()=(block_learn:a, block_priest:a, allow_learn:a, allow_priest:a, list_names:a, kit_names:a)</strong> dimorphic (<a href="ui_spell_system.html">ui_spell_system</a>)<br></p><p>
Read in all the spell lists, and store them in arrays block_learn, block_priest, allow_learn, allow_priest, in this format:
$allow_priest(OHTEMPUS combat)=1. Also return a k=>_ array of all list names, and a k=> array of all kit names.
</p>
<p><strong>ui_read_spell_lists(literal:b, kit:s)=(learn:s, priest:s, block_learn:s, block_priest:s)</strong> action (<a href="ui_spell_system.html">ui_spell_system</a>)<br></p><p>
Read in the spell lists associated with a given kit. If literal=1, leave in the commas and quote marks; otherwise remove them.
</p>
<p><strong>ui_spell_system_schools(force_rebuild:b, tra:s=sfo_lua, tra_path:s="DEFAULT")=()</strong> action (<a href="ui_spell_system_schools.html">ui_spell_system_schools</a>)<br></p><p>
Sets up the spell system to include all the schools of magic as defined spell lists.
</p>
<p><strong>ui_spell_system_setup()=()</strong> action (<a href="ui_spell_system.html">ui_spell_system</a>)<br></p><p>
Set up the externalized spell system. (Idempotent.)
</p>
<p><strong>ui_spell_system_spheres(path:s="sphere", list:s="sphere_list.2da", tra:s="sphere", tra_path:s="MOD_FOLDER/lang", base_tra:s=sfo_lua, base_tra_path:s="DEFAULT", 3p_folder:s=dw_tof3p)=()</strong> action (<a href="ui_spell_system_spheres.html">ui_spell_system_spheres</a>)<br></p><p>
Sets up a sphere system. See ToF for format; by default we read a 2da of spheres at sphere/sphere_list.2da, and then look for text files listing the various spells in each
sphere in 'sphere'.
</p>
<p><strong>ui_stress_test()=()</strong> action (<a href="ui_shared_code.html">ui_shared_code</a>)<br></p><p>
Run a bunch of SFO-LUA's core UI edits and report when each is installed. For use in testing SFO-LUA on different UI mods.</p><p></p>
<p><strong>ui_subrace_item_use()=()</strong> action (<a href="ui_add_subraces.html">ui_add_subraces</a>)<br></p><p>
Goes through all items in the game to make sure that they're appropriately marked as unusable by new races. We assume that the new race can use something iff humans can (except that if <b>only</b> humans are prohibited from using it, we assume new races can use it). This is idempotent but not called automatically.
</p>
<p><strong>ui_system_call_setup()=()</strong> action (<a href="ui_system_call.html">ui_system_call</a>)<br></p><p>
Set up the system-call system, making appropriate menu edits and collecting data for lua libraries.
</p>
<p><strong>virtual_class_setup()=()</strong> action (<a href="ui_virtual_class.html">ui_virtual_class</a>)<br></p><p>
Set up the various lua files and menu edits for virtual classes
</p>








</div>



</div>
</div>
</body>