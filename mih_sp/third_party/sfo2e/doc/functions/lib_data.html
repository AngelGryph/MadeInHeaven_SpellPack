<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>lib_data function library</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../../doc/files/g3readme_cam_022916_dwedit.css" type="text/css" />
<link href="../../doc/files/g3icon.ico" rel="icon" type="image/bmp" />
</head>
<body>
<div id="container">
<div class="ribbon_bubble">
    <div class="ribbon_rectangle">
<h1>lib_data function library</h1>
</div>
    <div class="ribbon_triangle-l"></div>
    <div class="ribbon_triangle-r"></div>

<div class="section">
<p><strong>Dependencies:</strong> lib_2da, lib_anon, lib_array, lib_fn, lib_ini, lib_sfo, lib_sugar, lib_tools, lib_ui</p>
</div>

<div class="ribbon_rectangle_h2"><h2>Description</h2> </div>
    <div class="ribbon_triangle_h2-l"></div>
    <div class="ribbon_triangle_h2-r"></div>

<div class="section">
<p>Contains macros and functions that load various bits of game data (saves, dvs, spell resrefs, etc etc) into WEIDU data structures.</p>
</div>

<div class="ribbon_rectangle_h2"><h2>Public functions</h2> </div>
    <div class="ribbon_triangle_h2-l"></div>
    <div class="ribbon_triangle_h2-r"></div>

<div class="section">
<p><strong>data_hp_range</strong> action_macro<br></p><p>
Works out the minimum and maximum hit points for all classes for levels 1-40 and stores them in the arrays $class_hp_minimum(class level), $class_hp_maximum(class level), with class in uppercase. Barbarians are also included.</p><p>At present this is *hard-coded*, on speed grounds: it will not allow for changes made to the HP tables.
</p>
<p><strong>data_joinable_dvs</strong> action_macro<br></p><p>
Returns the array 'sfo_joinable_dvs', in k=>_ form, containing the lowercased dvs of all joinable creatures
</p>
<p><strong>data_levels_by_max_level()=(array:a)</strong> action<br></p><p>
Returns an array that identifies, for each multiclass and each level N, what level the individual classes are when the highest-level class is level N. For instance, $array(CLERIC_THIEF 10 CLERIC)=8, because thieves reach level 10 before clerics and when a thief has enough XP for level 10, a cleric would be level 8.
</p>
<p><strong>data_priest_spells</strong> action_macro<br></p><p>
Return arrays "sfo_druid_spells" and "sfo_cleric_[alignment]_spells_n", containing the learnable cleric and druid spells of in resref=>level form.
[alignment] is each of the nine alignments as presented in align.ids, lowercased. Arrays are ordered from highest to lowest level and from highest-numbered
to lowest-numbered spell (this facilitates correctly (or at least intuitively) ordering the learned-spell lists if we use cre_quickset_known_spells).
</p>
<p><strong>data_priest_spells_by_type()=(druid_spells:a, cleric_spells:a)</strong> dimorphic<br></p><p>
Goes through all spells in the SPPR namespace and returns a resref=>discard array of druid and cleric spells. We don't return spells in HIDESPL or in the hardcoded list of spells in the 50-99 namespace that aren't in use
</p>
<p><strong>data_proficiencies()=(weapprof:a, profs:a, profsmax:a)</strong> dimorphic<br></p><p>
Returns the (uppercase-rows/cols) arrays 'weapprof','profs', and 'profsmax', containing the contents of weapprof.2da and prof.2da respectively.
For weapprof, columns are indexed by the proficiency ID.
Adds SORCERER entries automatically to weapprof, cloning MAGE.</p><p>If copies of these files exist in weidu_external/data/dw_shared, use those instead (these are generated by ToF's externalized proficiency system.)
</p>
<p><strong>data_saving_throws</strong> action_macro<br></p><p>
Read in saving throws for all classes and store in a 3da struct, in the form 
sfo_saves_%class%_%level%_=n, up to level 50 (padding out if necessary)</p><p>Here type is 'death','wands','polymorph','breath', or 'spells', and class is lowercased.
</p>
<p><strong>data_scroll_resrefs</strong> action_macro<br></p><p>
Reads in every divine and arcane
spell, and stores them like this:</p><p>WIZARD_FIREBALL_SCROLL=scrl1g
$sfo_arcane_scrolls("WIZARD_FIREBALL")=scrl1g
CLERIC_FREE_ACTION_SCROLL=scrl58
$sfo_divine_scrolls("CLERIC_FREE_ACTION")=scrl58</p><p></p>
<p><strong>data_spell_resrefs</strong> action_macro<br></p><p>
Read in every entry in spell.ids and set a variable with that name whose
value is the spell resref, and store the data in the sfo_spell_resrefs array.
Also store the spell type</p><p>e.g. WIZARD_FIREBALL = SPWI304
     $sfo_spell_resrefs("WIZARD_FIREBALL") = SPWI304
	 WIZARD_FIREBALL_LEVEL = wizard
	 $sfo_spell_types("WIZARD_FIREBALL") = wizard</p><p>Also, for wizard/priest spells, store the spell level in the format</p><p>WIZARD_FIREBALL_LEVEL=3</p><p></p><p>If extended spell namespace is in use, add the spells from dw_ext_spell.ids too.</p><p>Also check for spells in the DWWP, DWPW, DWPI, DWWI namespace (as per ToF naming
conventions) , e.g.</p><p>CLERIC_FIREBALL=DWWP304
CLERIC_FIREBALL_LEVEL=3
INNATE_WIZARD_FIREBALL=DWWI304</p><p></p>
<p><strong>data_spells_by_level</strong> action_macro<br></p><p>
Read in spell slots for all classes and store in a struct 'sfo_spell_level', in the form</p><p>sfo_spell_level_%class%_%level%_%spell_level%"=n (# spells known at level)
sfo_spell_level_sl_to_cl_%class%_%level%=n (minimum level at which caster gets spells of this level)
sfo_spell_level_cl_to_sl_%class%_%level%=n (maximum level of spells known at caster level)
sfo_spell_level_max_%class%=n (max level of spells known)</p><p></p>
<p><strong>data_thac0</strong> action_macro<br></p><p>
Read in thac0 for all classes and store in a 2da, in the form 
$sfo_thac0("class" "level")=n up to level 50, padding out if necessary. 'class' is lowercased.
</p>
<p><strong>data_vanilla_high_spells()=(vanilla_high_spells:a)</strong> dimorphic<br></p><p>
This just loads a hardcoded (uppercased, resref=>discard) list of hidden spells in the 50-99 namespace. It allows for the Spell Revisions mod.
</p>



</div>
<div class="ribbon_rectangle_h2"><h2>Internal functions</h2> </div>
<div class="ribbon_triangle_h2-l"></div>
<div class="ribbon_triangle_h2-r"></div>
<div class="section">
<p>These should not be called from outside the library itself.</p>
<p><strong>data_hp_range()=(class_hp_minimum:a, class_hp_maximum:a)</strong> action<br></p><p>
Works out the minimum and maximum hit points for all classes for levels 1-40 and stores them in the arrays $class_hp_minimum(class level), $class_hp_maximum(class level), with class in uppercase. Barbarians are also included.</p><p>At present this is *hard-coded*, on speed grounds: it will not allow for changes made to the HP tables.
</p>
<p><strong>data_internal_scroll_resrefs()=(sfo_arcane_scrolls:a, sfo_divine_scrolls:a)</strong> action<br></p>
<p><strong>data_internal_spell_resrefs()=(sfo_spell_resrefs:a, sfo_spell_levels:a, sfo_spell_types:a)</strong> action<br></p>
<p><strong>data_joinable_dvs_core()=(sfo_joinable_dvs:a)</strong> action<br></p>
<p><strong>data_priest_spells_core()=(sfo_cleric_lawful_good_spells:a, sfo_cleric_neutral_good_spells:a, sfo_cleric_chaotic_good_spells:a, sfo_cleric_lawful_neutral_spells:a, sfo_cleric_neutral_spells:a, sfo_cleric_chaotic_neutral_spells:a, sfo_cleric_lawful_evil_spells:a, sfo_cleric_neutral_evil_spells:a, sfo_cleric_chaotic_evil_spells:a, sfo_druid_spells:a)</strong> action<br></p>
<p><strong>data_thac0_helper()=(sfo_thac0:a)</strong> action<br></p><p>
Encapsulated innards of the data_thac0 macro.
</p>





</div>



</div>
</div>
</body>