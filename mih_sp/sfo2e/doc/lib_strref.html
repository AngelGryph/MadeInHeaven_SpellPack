<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>lib_strref function library</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../../doc/files/g3readme_cam_022916_dwedit.css" type="text/css" />
<link href="../../doc/files/g3icon.ico" rel="icon" type="image/bmp" />
</head>
<body>
<div id="container">
<div class="ribbon_bubble">
    <div class="ribbon_rectangle">
<h1>lib_strref function library</h1>
</div>
    <div class="ribbon_triangle-l"></div>
    <div class="ribbon_triangle-r"></div>

<div class="section">
<p><strong>Dependencies:</strong> alter_effect, ds, lib_2da, lib_anon, lib_array, lib_fn, lib_ini, lib_sfo, lib_struct, lib_sugar, lib_tools</p>
</div>

<div class="ribbon_rectangle_h2"><h2>Description</h2> </div>
    <div class="ribbon_triangle_h2-l"></div>
    <div class="ribbon_triangle_h2-r"></div>

<div class="section">

</div>

<div class="ribbon_rectangle_h2"><h2>Functions</h2> </div>
    <div class="ribbon_triangle_h2-l"></div>
    <div class="ribbon_triangle_h2-r"></div>

<div class="section">
<p><strong>strref_2da(function:s)=()</strong> patch<br></p><p>
Acting on the current file, assumed to be a 2da file, apply 'function' to each of the strrefs in it.</p>
<p>
Note that detection of which numbers in a 2da file are strrefs is of necessity a bit
heuristic. We assume that 
<ul>
<li>no integer lower than 160 is a strref (the actual values from 1-100 in BG2 are
dialog strings not referenced in 2das)
<li>no integer larger than 299999 is a strref (this is way bigger than any actual dlg)
<li>no integer in the following 2das is a strref:
   banttimg clearair extanim extspeed happy pplane raisdead randcolr repmodst splashs2 splashsc startare startbp startpos strmod strmodex xpbonus xpcap xplevel xplist
<li>no integer <10000 in the following is a strref:
end15fps endmve1 endmve2 endmve3 intro intro15f melissan xnewarea
<li>no integer in columns 0-2 of clastext is a strref
<li>nothing in hex notation is a strref
<li>all other integers are strrefs
</ul>
</p>
<p><strong>strref_apply(function:f)=()</strong> patch<br></p><p>
Apply the (SFO standard patch) function 'function' to every strref in the current file, replacing it with the output. Currently doesn't do wmp files.
</p>
<p><strong>strref_script(function:s)=()</strong> patch<br></p><p>
Acting on the current file, assumed to be a decompiled script, apply 'function' to each of the strrefs in it
</p>



</div>
<div class="ribbon_rectangle_h2"><h2>Internal functions</h2> </div>
<div class="ribbon_triangle_h2-l"></div>
<div class="ribbon_triangle_h2-r"></div>
<div class="section">
<p>These should not be called from outside the library itself.</p>
<p><strong>strref_opcode(opcode_offset:i, parameter1_offset:i, parameter2_offset:i, special_offset:i, function:s)=()</strong> patch<br></p><p>
Read the opcode at opcode_offset and, if appropriate, apply 'function' to any strref encoded in it
</p>
<p><strong>strref_struct(function:f)=()</strong> patch<br></p><p>
Go through a struct file, applying 'function' to each strref in it and returning the new one. Also does opcodes.
</p>
<p><strong>strref_struct_helper(struct:a, strtype:s, function:f)=(struct:a)</strong> patch<br></p>





</div>



</div>
</div>
</body>